<h1>{{title}}</h1>

<form id="productForm">
  <input type="text" name="title" placeholder="TÃ­tulo" required />
  <input type="text" name="description" placeholder="DescripciÃ³n" required />
  <input type="text" name="code" placeholder="CÃ³digo" required />
  <input type="number" name="price" placeholder="Precio" required />
  <input type="number" name="stock" placeholder="Stock" required />
  <input type="text" name="category" placeholder="CategorÃ­a" required />
  <input type="text" name="thumbnails" placeholder="Thumbnail (URL)" />
  <button type="submit">Agregar producto</button>
</form>

<ul id="productList"></ul>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();
  const form = document.getElementById("productForm");
  const list = document.getElementById("productList");

  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const data = Object.fromEntries(new FormData(form).entries());
    data.price = parseFloat(data.price);
    data.stock = parseInt(data.stock);
    data.thumbnails = [data.thumbnails];

    socket.emit("newProduct", data, (response) => {
      if (response.status === "success") {
        alert("âœ… Producto creado correctamente");
      } else {
        alert("âŒ Error: " + response.message);
      }
    });

    form.reset();
  });

  socket.on("updateProducts", (products) => {
    list.innerHTML = "";
    products.forEach((p) => {
      const item = document.createElement("li");
      item.innerHTML = `
        <strong>${p.title}</strong> - $${p.price}
        <button onclick="deleteProduct('${p._id}')">âŒ</button>
      `;
      list.appendChild(item);
    });
  });

  function deleteProduct(id) {
    socket.emit("deleteProduct", id, (response) => {
      if (response.status === "success") {
        alert("ğŸ—‘ï¸ Producto eliminado correctamente");
      } else {
        alert("âŒ Error: " + response.message);
      }
    });
  }
</script>
